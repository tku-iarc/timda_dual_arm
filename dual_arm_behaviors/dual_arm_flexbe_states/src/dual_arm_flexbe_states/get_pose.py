#!/usr/bin/env python

from flexbe_core import EventState, Logger
from arm_control import Command

right_c_pose = [[[0.5022728829717511, -0.261248327548225,   -0.002510953338052603,], [ 0.05331214002166357, 74.65792458021502,  0.06337251894565969, ], -0],
                [[0.5031123648350082, -0.04043193288831777, -0.06547315022754449, ], [-10.20392555186906,   74.58744891759585, -0.000119274099985916,], -0],
                [[0.525530662483441,  -0.08308183343130505, -0.05351415654100983, ], [-22.40352584903326,   63.87173907086792, -0.02369158474965406, ], -0],
                [[0.5266675579478259, -0.1319401998174144,  -0.02380926693679808, ], [-43.61933743112927,   63.80247094910232, -0.1297594779958388,  ], -0],
                [[0.5269723930424395, -0.06574322711920698, -0.05364590073202039, ], [-68.04140824688895,   63.78608835251243, -0.1597996226962361,  ], -1.207418269725733e-06],
                [[0.5270769760067999, -0.06577762263693067,  0.03399384384781029, ], [-68.04841396320886,   63.78216302331231, -0.1753758208530155,  ], -3.078324659199975e-06],
                [[0.5272092900902987, -0.06582212291928258,  0.07255324533775831, ], [-82.4680992940786,    67.51613737133755, -0.1960948975294225,  ], -0],
                [[0.5280539813753632, -0.1540678604564929,  -0.07786178981456808, ], [ 14.3691586823422,    77.68382391186351, -0.2298830595211877,  ], -0],
                [[0.4823415350671684, -0.2399701948205364,  -0.08925383410436771, ], [ 28.04875340603212,   77.65837139858763, -0.2352478929567015,  ], -0],
                [[0.4791931993168074, -0.3149709612270601,  -0.1314791281837705,  ], [ 44.22395960243066,   77.62795426419487, -0.2457129339789655,  ], -0],
                [[0.4138575366293342, -0.297527484295576,   -0.2126739825191691,  ], [ 60.58006338433427,   66.3474808736441,  -11.95869213814548,   ], -0],
                [[0.4139939455668695, -0.2975475105725396,  -0.2852077107466298,  ], [ 75.32258426252123,   66.34753499853126, -11.96455947827606,   ], -0],
                [[0.4121825233908999, -0.319210126629863,   -0.2530958086474356,  ], [ 74.79920625273058,   66.64329176528997, -6.085190075340546,   ], -15.71553991053553],
                [[0.4123827640796597, -0.3193150560478027,  -0.1468756819758649,  ], [ 74.790731418693,     66.64335354449192, -6.107679999675296,   ], -15.72096225956446],
                [[0.4147377995611876, -0.4293097186830637,  -0.1907875458258219,  ], [ 75.18244454404424,   96.58401763743851,  11.45644267135307,   ],  16.56934230738585],
                [[0.4150644218349576, -0.4295692602099899,  -0.2836906345115083,  ], [ 75.21163971739115,   108.7901650180467,  11.38845247440495,   ],  16.64490865236882],
                [[0.4151721273681787, -0.4298914174447654,  -0.4091692158745216,  ], [ 75.22962615126963,   120.8127021400017,  11.32261873301032,   ],  16.72212785351192],
                [[0.4238030391923046, -0.3112565144187608,  -0.4169273091393302,  ], [ 46.36080028874433,   120.8568503533463, -2.690389443070493,   ],  17.0316218545143],
                [[0.4242931851394318, -0.1617764832546068,  -0.3877009376970814,  ], [ 46.37267289744338,   117.4385590058583, -18.64582960792653,   ],  17.08024512224669],
                [[0.4197479786921792, -0.1711877155854302,  -0.3969178320297976,  ], [-5.035224992939342,   117.4393858139155, -18.65125261731989,   ],  17.08080629014662],
                [[0.5004538080655432, -0.2532141209025338,  -0.06718596221420141, ], [ 0.0323699884883336,  65.01652468420149, -0.03279616184726517, ], -7.011867844079209e-05],
                [[0.5008529474659436, -0.3355746512003659,  -0.0795152955502393,  ], [ 0.03174282075550094, 64.97838972621923, -0.008572001027169684,], -7.070874784871437e-05],
                [[0.5012091875650093, -0.3880340515253939,  -0.07990131419809376, ], [ 0.03823722452664159, 64.95018528966597,  0.02866793345451034, ], -7.163562836185784e-05],
                [[0.5016784266586852, -0.4281358694143783,   0.08159055375953016, ], [ 0.04726460637440334, 69.6466404688525,   0.04312863619678441, ], -3.306651113363206e-06],]

left_c_pose = [[[0.5004538080655432, 0.2532141209025338,  -0.06718596221420141, ], [ -0.0323699884883336,  65.01652468420149,   0.03279616184726517, ],   7.011867844079209e-05],
               [[0.5008529474659436, 0.3355746512003659,  -0.0795152955502393,  ], [ -0.03174282075550094, 64.97838972621923,   0.008572001027169684,],   7.070874784871437e-05],
               [[0.5012091875650093, 0.3880340515253939,  -0.07990131419809376, ], [ -0.03823722452664159, 64.95018528966597,  -0.02866793345451034, ],   7.163562836185784e-05],
               [[0.5016784266586852, 0.4281358694143783,   0.08159055375953016, ], [ -0.04726460637440334, 69.6466404688525,   -0.04312863619678441, ],   3.306651113363206e-06],
               [[0.5022728829717511, 0.261248327548225,   -0.002510953338052603,], [ -0.05331214002166357, 74.65792458021502,  -0.06337251894565969, ],   0],
               [[0.5031123648350082, 0.04043193288831777, -0.06547315022754449, ], [  10.20392555186906,   74.58744891759585,   0.000119274099985916,],   0],
               [[0.525530662483441,  0.08308183343130505, -0.05351415654100983, ], [  22.40352584903326,   63.87173907086792,   0.02369158474965406, ],   0],
               [[0.5266675579478259, 0.1319401998174144,  -0.02380926693679808, ], [  43.61933743112927,   63.80247094910232,   0.1297594779958388,  ],   0],
               [[0.5269723930424395, 0.06574322711920698, -0.05364590073202039, ], [  68.04140824688895,   63.78608835251243,   0.1597996226962361,  ],   1.207418269725733e-06],
               [[0.5270769760067999, 0.06577762263693067,  0.03399384384781029, ], [  68.04841396320886,   63.78216302331231,   0.1753758208530155,  ],   3.078324659199975e-06],
               [[0.5272092900902987, 0.06582212291928258,  0.07255324533775831, ], [  82.4680992940786,    67.51613737133755,   0.1960948975294225,  ],   0],
               [[0.4791931993168074, 0.3149709612270601,  -0.1314791281837705,  ], [ -44.22395960243066,   77.62795426419487,   0.2457129339789655,  ],   0],
               [[0.4138575366293342, 0.297527484295576,   -0.2126739825191691,  ], [ -60.58006338433427,   66.3474808736441,    11.95869213814548,   ],   0],
               [[0.4139939455668695, 0.2975475105725396,  -0.2852077107466298,  ], [ -75.32258426252123,   66.34753499853126,   11.96455947827606,   ],   0],
               [[0.4121825233908999, 0.319210126629863,   -0.2530958086474356,  ], [ -74.79920625273058,   66.64329176528997,   6.085190075340546,   ],   15.71553991053553],
               [[0.4123827640796597, 0.3193150560478027,  -0.1468756819758649,  ], [ -74.790731418693,     66.64335354449192,   6.107679999675296,   ],   15.72096225956446],
               [[0.4147377995611876, 0.4293097186830637,  -0.1907875458258219,  ], [ -75.18244454404424,   96.58401763743851,  -11.45644267135307,   ],  -16.56934230738585],
               [[0.4150644218349576, 0.4295692602099899,  -0.2836906345115083,  ], [ -75.21163971739115,   108.7901650180467,  -11.38845247440495,   ],  -16.64490865236882],
               [[0.4151721273681787, 0.4298914174447654,  -0.4091692158745216,  ], [ -75.22962615126963,   120.8127021400017,  -11.32261873301032,   ],  -16.72212785351192],
               [[0.4238030391923046, 0.3112565144187608,  -0.4169273091393302,  ], [ -46.36080028874433,   120.8568503533463,   2.690389443070493,   ],  -17.0316218545143],
               [[0.4242931851394318, 0.1617764832546068,  -0.3877009376970814,  ], [ -46.37267289744338,   117.4385590058583,   18.64582960792653,   ],  -17.08024512224669],
               [[0.4197479786921792, 0.1711877155854302,  -0.3969178320297976,  ], [  5.035224992939342,   117.4393858139155,   18.65125261731989,   ],  -17.08080629014662],
               [[0.5280539813753632, 0.1540678604564929,  -0.07786178981456808, ], [ -14.3691586823422,    77.68382391186351,   0.2298830595211877,  ],   0],
               [[0.4823415350671684, 0.2399701948205364,  -0.08925383410436771, ], [ -28.04875340603212,   77.65837139858763,   0.2352478929567015,  ],   0]]

c_pose = {'left_arm' : left_c_pose,
          'right_arm': right_c_pose}

class GetPoseState(EventState):
	"""
	Publishes a pose from userdata so that it can be displayed in rviz.

	-- robot_name              string          Robots name to move

	#> robot_cmd               command(dict)   See arm_task.py

	<= done									   Pose has been published.
	<= finish								   Task finished

	"""
	
	def __init__(self, robot_name):
		"""Constructor"""
		super(GetPoseState, self).__init__(outcomes=['done', 'finish'], output_keys=['robot_cmd'])
		self.robot_name = robot_name
		self.move_mode = 'p2p'
		self.total_pose = len(c_pose[self.robot_name])
		self.pose_indx = 0

	def execute(self, userdata):
		if self.pose_indx == self.total_pose:
			return 'finish'
		else:
			userdata.robot_cmd = Command()
			userdata.robot_cmd['mode'] = 'p2p'
			userdata.robot_cmd['speed'] = 100
			userdata.robot_cmd['pos'] = c_pose[self.robot_name][self.pose_indx][0]
			userdata.robot_cmd['euler'] = c_pose[self.robot_name][self.pose_indx][1]
			userdata.robot_cmd['phi'] = c_pose[self.robot_name][self.pose_indx][2]
			return 'done'
	
	def on_enter(self, userdata):
		self.pose_indx += 1
			